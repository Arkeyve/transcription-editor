function setCookie(e,t){var r=new Date;r.setTime(r.getTime()+2592e6),document.cookie=e+"="+t+"; expires="+r.toUTCString()+"; path=/"}function toHHMMssmmm(e){var t=parseInt(1e3*e,10),r=Math.floor(t/36e5);t%=36e5;var s=Math.floor(t/6e4);t%=6e4;var i=Math.floor(t/1e3);return t%=1e3,r<10&&(r="0"+r),s<10&&(s="0"+s),i<10&&(i="0"+i),t<100&&(t=t<10?"00"+t:"0"+t),r+":"+s+":"+i+","+t}function togglePlayPause(){document.getElementById("playpause").classList.toggle("fa-play"),document.getElementById("playpause").classList.toggle("fa-pause")}function activeSpeed(){var e={.5:0,1:1,1.25:2,1.5:3,1.75:4,2:5},t=document.querySelectorAll(".speed");[].forEach.call(t,function(e){e.classList.remove("activespeed")}),t[e[wavesurfer.backend.playbackRate]].classList.add("activespeed")}function loadJSON(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===this.readyState&&200===this.status&&t(this.responseText)},r.open("GET",e,!0),r.send()}function saveJSON(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status?(console.log("Saved"),e&&alert("Changes successfully saved.")):4===this.readyState&&200!=this.status&&alert("Could not save changes, please check your internet connection or try again later.")},t.open("POST","./save.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("transcript="+JSON.stringify(transcript)+"&transcripturl="+pageOptions.transcriptURL)}function getHighlights(){var e=Array();if([].forEach.call(document.getElementsByClassName("highlight"),function(t){e.push({start:Number(t.getAttribute("starttime")),end:Number(t.getAttribute("endtime"))})}),highlights={},e.length>0){highlights[0]=Number(e[0].start.toFixed(1));for(var t=0;t<e.length-1;t++)Number(e[t+1].start.toFixed(1))>Number(e[t].end+.2).toFixed(1)&&(highlights[(e[t].end-.2).toFixed(1)]=Number(e[t+1].start.toFixed(1)),highlights[(e[t].end-.1).toFixed(1)]=Number(e[t+1].start.toFixed(1)),highlights[e[t].end.toFixed(1)]=Number(e[t+1].start.toFixed(1)),highlights[(e[t].end+.1).toFixed(1)]=Number(e[t+1].start.toFixed(1)),highlights[(e[t].end+.2).toFixed(1)]=Number(e[t+1].start.toFixed(1)));e.length>1&&(highlights[(e[t].end-.2).toFixed(1)]=highlights[0],highlights[(e[t].end-.1).toFixed(1)]=highlights[0],highlights[e[t].end.toFixed(1)]=highlights[0],highlights[(e[t].end+.1).toFixed(1)]=highlights[0],highlights[(e[t].end+.2).toFixed(1)]=highlights[0])}}function getStrikes(){var e=Array();[].forEach.call(document.getElementsByClassName("strike"),function(t){e.push({start:Number(t.getAttribute("starttime")),end:Number(t.getAttribute("endtime"))})}),strikes={};for(var t,r,s=0;s<e.length;s++){for(t=e[s].start.toFixed(1);s<e.length-1&&e[s].end.toFixed(1)===e[s+1].start.toFixed(1);)s++;(r=Number(e[s].end.toFixed(1)))>Number(t)+.2&&(strikes[(Number(t)-.2).toFixed(1)]=r,strikes[(Number(t)-.1).toFixed(1)]=r,strikes[t]=r,strikes[(Number(t)+.1).toFixed(1)]=r,strikes[(Number(t)+.2).toFixed(1)]=r)}}function showFindReplace(e){var t=document.getElementById("find-replace-wrapper");t.setAttribute("style","top: "+e.clientY+"px; left: "+e.clientX+"px;"),t.classList.remove("hidden"),setTimeout(function(){t.classList.remove("invisible")},50)}function showExport(e){var t=document.getElementById("export-wrapper");t.setAttribute("style","top: "+e.clientY+"px; left: "+e.clientX+"px;"),t.classList.remove("hidden"),setTimeout(function(){t.classList.remove("invisible")},50)}function showHelp(e){var t=document.getElementById("help-wrapper");t.classList.remove("hidden"),setTimeout(function(){t.classList.remove("invisible")},50)}function enableUI(){document.getElementById("loader").classList.toggle("spinning"),document.getElementById("main-container-mask").classList.toggle("invisible"),setTimeout(function(){document.getElementById("main-container-mask").setAttribute("style","display: none")},30)}function seekToWord(e){wavesurfer.seekTo(e.id/wavesurfer.getDuration())}function resizeBody(){wavesurfer.drawBuffer(),wavesurfer.drawer.progress(wavesurfer.backend.getPlayedPercents());var e=document.getElementsByClassName("main-container")[0].offsetHeight,t=window.innerHeight-e;document.getElementsByClassName("transcript-container")[0].setAttribute("style","height: "+t+"px"),document.getElementById("text-options").setAttribute("style","margin-top: "+e+"px")}function fillWords(){for(var e,t=transcript.results[0].results,r=transcript.results[0].speaker_labels,s=(Array(),Array(),0),i=0,n=document.getElementById("transcript-area"),a=document.getElementById("speakerlist");n.hasChildNodes();)n.removeChild(n.lastChild);n.appendChild(a),t.forEach(function(t,a){var l;t.alternatives.forEach(function(t,r){t.confidence>0&&(l=t,e=r)});var o,d,u,c,p;l.timestamps.forEach(function(t,l){if((o=r[s++].speaker)!=d){if(u){n.appendChild(u);var m=document.createElement("br");m.classList.add("special-break"),n.appendChild(m)}(u=document.createElement("div")).setAttribute("title",o),u.setAttribute("contenteditable","true"),u.classList.add("speaker-div"),(c=document.createElement("input")).value=o,c.classList.add("speaker"),c.setAttribute("list","speakerlist"),c.setAttribute("speakername",o),c.setAttribute("speakerindex",s-1),c.setAttribute("style","width: "+(8*c.value.length+20)+"px"),c.setAttribute("onkeyup","resizeInput(this);"),c.setAttribute("onclick","handleList(this)"),c.setAttribute("onblur","handleValue(this)"),c.setAttribute("onchange","changeInput(this);"),n.appendChild(c)}if(""!=t[0].trim()){(p=document.createElement("span")).innerHTML=t[0],p.setAttribute("starttime",t[1]),p.setAttribute("endtime",t[2]),p.setAttribute("oldval",t[0]),p.setAttribute("resultindex",a),p.setAttribute("alternativeindex",e),p.setAttribute("wordindex",l),p.setAttribute("speakerindex",i),p.setAttribute("title",t[1]+" - "+t[2]),p.setAttribute("tabindex","-1"),p.addEventListener("focus",function(){seekToWord(this)}),p.id=t[1],p.classList.add("word");var g="h"+t[1],h="s"+t[1];t[3]?t[3].highlight?(p.classList.add("highlight"),g in wavesurfer.regions.list||wavesurfer.addRegion({id:g,start:p.getAttribute("starttime"),end:p.getAttribute("endtime"),color:"rgba(255, 255, 0, 0.3)",drag:!1,resize:!1})):t[3].strike?(p.classList.add("strike"),h in wavesurfer.regions.list||wavesurfer.addRegion({id:h,start:p.getAttribute("starttime"),end:p.getAttribute("endtime"),color:"rgba(100, 100, 100, 0.5)",drag:!1,resize:!1})):(g in wavesurfer.regions.list&&wavesurfer.regions.list[g].remove(),h in wavesurfer.regions.list&&wavesurfer.regions.list[h].remove()):(g in wavesurfer.regions.list&&wavesurfer.regions.list[g].remove(),h in wavesurfer.regions.list&&wavesurfer.regions.list[h].remove()),u.appendChild(p)}i++,d=o}),n.appendChild(u);var m=document.createElement("br");m.classList.add("special-break"),n.appendChild(m)}),[].forEach.call(document.querySelectorAll(".word"),function(e){wordObserver.observe(e,{characterData:!0,subtree:!0}),wordChildObserver.observe(e,{childList:!0})}),[].forEach.call(document.querySelectorAll(".speaker-div"),function(e){nodeObserver.observe(e,{childList:!0})}),getHighlights(),getStrikes()}function wordMutation(e){e.forEach(function(e){var t=e.target.parentElement,r=t.getAttribute("resultindex"),s=t.getAttribute("alternativeindex"),i=t.getAttribute("wordindex");if(t.innerText!=transcript.results[0].results[r].alternatives[s].timestamps[i][0]){pastStack.push(JSON.stringify(transcript));var n=t.innerText;transcript.results[0].results[r].alternatives[s].timestamps[i][0]=n;var a="";transcript.results[0].results[r].alternatives[s].timestamps.forEach(function(e){a+=e[0]}),transcript.results[0].results[r].alternatives[s].transcript=a;var l,o;if(this===t.parentElement.firstChild){if("0"===r)o="0";else if("0"===i){var d=Number(r)-1,u=transcript.results[0].results[d].alternatives[0].timestamps.length-1;o=transcript.results[0].results[d].alternatives[0].timestamps[u][2]}else{u=Number(i)-1;o=transcript.results[0].results[r].alternatives[0].timestamps[u][2]}transcript.results[0].results[r].alternatives[s].timestamps[i][1]=o,t.setAttribute("starttime",o),t.id=o,t.setAttribute("title",o+" - "+t.getAttribute("endtime"))}else t.nextSibling&&(l=t.nextSibling.getAttribute("starttime"),transcript.results[0].results[r].alternatives[s].timestamps[i][2]=l,t.setAttribute("endtime",l),t.setAttribute("title",t.getAttribute("starttime")+" - "+l));/highlight/i.test(t.classList.value)&&(GLOBAL_ACTIONS.highlight(),GLOBAL_ACTIONS.highlight()),/strike/i.test(t.classList.value)&&(GLOBAL_ACTIONS.strike(),GLOBAL_ACTIONS.strike())}})}function wordChildMutation(e){if(pastStack.push(JSON.stringify(transcript)),e[0].addedNodes.length>0){wordObserver.disconnect(),nodeObserver.disconnect(),wordChildObserver.disconnect(),currWord=e[e.length-1].target;for(var t=Array();currWord;)t.push(currWord),transcript.results[0].speaker_labels[currWord.getAttribute("speakerindex")].speaker="Unknown Speaker",currWord=currWord.nextSibling;var r=t[0].parentNode.nextSibling;t[0].innerText=t[0].getAttribute("oldval");var s=document.getElementById("transcript-area"),i=document.createElement("br");i.classList.add("special-break"),div=document.createElement("div"),div.setAttribute("title","Unknown Speaker"),div.setAttribute("contenteditable","true"),div.classList.add("speaker-div"),speakerName=document.createElement("input"),speakerName.value="Unknown Speaker",speakerName.classList.add("speaker"),speakerName.setAttribute("list","speakerlist"),speakerName.setAttribute("speakerindex",t[0].getAttribute("speakerindex")),speakerName.setAttribute("speakername","Unknown Speaker"),speakerName.setAttribute("style","width: "+(8*speakerName.value.length+20)+"px"),speakerName.setAttribute("onkeyup","resizeInput(this);"),speakerName.setAttribute("onclick","handleList(this)"),speakerName.setAttribute("onblur","handleValue(this)"),speakerName.setAttribute("onchange","changeInput(this);"),t.forEach(function(e){div.appendChild(e)}),s.insertBefore(i,r),s.insertBefore(speakerName,r),s.insertBefore(div,r),[].forEach.call(document.querySelectorAll(".word"),function(e){wordObserver.observe(e,{characterData:!0,subtree:!0}),wordChildObserver.observe(e,{childList:!0})})}else e.forEach(function(e){e.removedNodes.forEach(function(e){var t=e.getAttribute("resultindex"),r=e.getAttribute("alternativeindex"),s=e.getAttribute("wordindex");transcript.results[0].results[t].alternatives[r].timestamps[s][0]=""})})}function nodeMutation(e){if(pastStack.push(JSON.stringify(transcript)),e[0].addedNodes.length>0){wordObserver.disconnect(),wordChildObserver.disconnect(),nodeObserver.disconnect();var t=Array();e.forEach(function(e){e.removedNodes.forEach(function(e){""!=e.innerText.trim()&&(t.push(e),index=e.getAttribute("speakerindex"),transcript.results[0].speaker_labels[index].speaker="Unknown Speaker")})});var r=t[0].parentNode.parentNode.nextSibling,s=document.getElementById("transcript-area"),i=document.createElement("br");i.classList.add("special-break"),div=document.createElement("div"),div.setAttribute("title","Unknown Speaker"),div.setAttribute("contenteditable","true"),div.classList.add("speaker-div"),speakerName=document.createElement("input"),speakerName.value="Unknown Speaker",speakerName.classList.add("speaker"),speakerName.setAttribute("list","speakerlist"),speakerName.setAttribute("name","speaker"),speakerName.setAttribute("speakername","Unknown Speaker"),speakerName.setAttribute("speakerindex",t[0].getAttribute("speakerindex")),speakerName.setAttribute("style","width: "+(8*speakerName.value.length+20)+"px"),speakerName.setAttribute("onkeyup","resizeInput(this);"),speakerName.setAttribute("onclick","handleList(this)"),speakerName.setAttribute("onblur","handleValue(this)"),speakerName.setAttribute("onchange","changeInput(this);"),t.forEach(function(e){div.appendChild(e)}),s.insertBefore(i,r),s.insertBefore(speakerName,r),s.insertBefore(div,r),oldDiv=e[0].target,oldDiv.removeChild(oldDiv.lastChild),t[0].id||(t[0].id=oldDiv.lastChild.id,t[0].innerText=t[0].getAttribute("oldval"),oldDiv.removeChild(oldDiv.lastChild)),[].forEach.call(document.querySelectorAll(".word"),function(e){wordObserver.observe(e,{characterData:!0,subtree:!0})}),[].forEach.call(document.querySelectorAll(".speaker-div"),function(e){nodeObserver.observe(e,{childList:!0})})}else e.forEach(function(e){e.removedNodes.forEach(function(e){var t=e.getAttribute("resultindex"),r=e.getAttribute("alternativeindex"),s=e.getAttribute("wordindex");transcript.results[0].results[t].alternatives[r].timestamps[s][0]=""})})}function readWords(){readWord=document.getElementsByClassName("read");try{currWord=readWord[0]?readWord[readWord.length-1].nextSibling?readWord[readWord.length-1].nextSibling:readWord[readWord.length-1].parentElement.nextSibling.nextSibling.nextSibling.firstChild:document.getElementsByClassName("word")[0]}catch(e){currWord=document.getElementsByClassName("word")[0]}var e=document.getElementById("transcript-area").getBoundingClientRect();if(currWord.id<wavesurfer.getCurrentTime()){for(;currWord&&currWord.id<wavesurfer.getCurrentTime();)currWord.classList.add("read"),currWord=currWord.nextSibling?currWord.nextSibling:currWord.parentElement.nextSibling.nextSibling.nextSibling.firstChild;if(e.top+150<currWord.getBoundingClientRect().top)var t=function(){e.top+150>=currWord.getBoundingClientRect().top?clearInterval(r):document.getElementById("transcript-area").scrollTop+=5},r=setInterval(t,10);(e.bottom<currWord.getBoundingClientRect().bottom||e.top>currWord.getBoundingClientRect().top)&&currWord.scrollIntoView()}else if([].forEach.call(document.querySelectorAll(".read"),function(e){e.id>wavesurfer.getCurrentTime()&&e.classList.remove("read")}),readWord=document.getElementsByClassName("read"),currWord=readWord[readWord.length-1],currWord&&((e.bottom<currWord.getBoundingClientRect().bottom||e.top>currWord.getBoundingClientRect().top)&&currWord.scrollIntoView(),e.top+100>currWord.getBoundingClientRect().top))var t=function(){e.top+100<=currWord.getBoundingClientRect().top?clearInterval(s):document.getElementById("transcript-area").scrollTop-=5},s=setInterval(t,10)}function changeInput(e){if(pastStack.push(JSON.stringify(transcript)),!e.value.trim()||isNaN(e.getAttribute("speakername"))){e.value.trim()||(e.value="Unknown Speaker"),e.setAttribute("speakername",e.value);for(var t=e.getAttribute("speakerindex"),r=e.nextSibling.nextSibling.nextSibling?Number(e.nextSibling.nextSibling.nextSibling.getAttribute("speakerindex")):transcript.results[0].speaker_labels.length,s=t;s<r;s++)transcript.results[0].speaker_labels[s].speaker=e.value}else{var i=e.value,n=e.getAttribute("speakername");e.value.length;transcript.results[0].speaker_labels.forEach(function(e){e.speaker==n&&(e.speaker=i)}),[].forEach.call(document.querySelectorAll(".speaker"),function(e){e.getAttribute("speakername")===n&&(e.value=i,e.setAttribute("speakername",i),resizeInput(e))})}if(!/Unknown Speaker/.test(e.value)){var a=document.getElementById("speakerlist"),l=!1;[].forEach.call(a.childNodes,function(t){t.value==e.value&&(l=!0)}),l||(datalistOption=document.createElement("option"),datalistOption.value=e.value,a.appendChild(datalistOption))}}function handleList(e){e.value=""}function handleValue(e){e.value=e.getAttribute("speakername"),resizeInput(e)}function resizeInput(e){e.setAttribute("style","width: "+(8*e.value.length+20)+"px")}function checkDeepLink(e){if("t"in e){var t=0;e.t=e.t.toLowerCase(),e.t.split("h").length>1&&(t+=3600*Number(e.t.split("h")[0]),e.t=e.t.split("h")[1]),e.t.split("m").length>1&&(t+=60*Number(e.t.split("m")[0]),e.t=e.t.split("m")[1]),e.t.split("s").length>1&&(t+=Number(e.t.split("s")[0]),e.t=e.t.split("s")[1]);var r=t/wavesurfer.getDuration();r<=1&&wavesurfer.seekTo(r)}}function getParameters(){var e={};return window.location.search.slice(1).split("&").forEach(function(t){var r=t.split("=");e[r[0]]=r[1]}),e}function getURLs(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&200===this.status?(pageOptions=JSON.parse(this.responseText)).metaURL&&pageOptions.transcriptURL&&pageOptions.audioURL?init():alert("Missing parameters. Please try later."):4===this.readyState&&200!=this.status&&alert("Server response invalid. Please try later.")},t.open("POST","./save.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send("id="+e)}function updateTime(){var e=wavesurfer.getCurrentTime(),t=wavesurfer.getDuration(),r=toHHMMssmmm(e).split(",")[0],s=toHHMMssmmm(t-e).split(",")[0];document.getElementById("elapsed-time").innerText=r,document.getElementById("remaining-time").innerText=s}function init(){window.onbeforeunload=function(e){return e||window.event,""},/hints=off/i.test(document.cookie)&&GLOBAL_ACTIONS["toggle-hints"](),/help=off/i.test(document.cookie)&&(GLOBAL_ACTIONS["toggle-help"](),GLOBAL_ACTIONS["close-help"]());var e={container:document.querySelector("#audioclip"),progressColor:"#f4364c",waveColor:"#3f88c5",cursorWidth:2,cursorColor:"#3f88c5",barWidth:2,normalize:!0,backend:"MediaElement",hideScrollbar:!0,height:95};wavesurfer.init(e),loadJSON(pageOptions.metaURL,function(e){var t=JSON.parse(e);silences=t.silences,wavesurfer.load(pageOptions.audioURL,t.peaks,"none")}),wavesurfer.on("audioprocess",function(){curr=wavesurfer.getCurrentTime().toFixed(1),readWords(),updateTime(),curr in strikes&&wavesurfer.backend.seekTo(strikes[curr]),playHighlights&&curr in highlights&&wavesurfer.backend.seekTo(highlights[curr]),skipSilences&&curr in silences&&wavesurfer.backend.seekTo(silences[curr])}),wavesurfer.on("finish",function(){GLOBAL_ACTIONS.stop()}),wavesurfer.on("seek",function(){readWords(),updateTime()}),wavesurfer.on("ready",function(){var e=Object.create(WaveSurfer.Timeline),t=100*Math.floor(wavesurfer.getDuration()/1e3)/2;e.init({wavesurfer:wavesurfer,container:"#audioclip-timeline",primaryColor:"#3f88c5",seondaryColor:"#f4364c",primaryFontColor:"#f6f7eb",secondaryFontColor:"#f6f7eb",timeInterval:t,height:15}),updateTime(),wavesurfer.addRegion({id:"dummy",start:0,end:0,drag:!1,resize:!1,color:"rgba(255, 255, 0, 0)"}),resizeBody(),enableUI(),activeSpeed(),nodeObserver=new MutationObserver(function(e){nodeMutation(e)}),wordObserver=new MutationObserver(function(e){wordMutation(e)}),wordChildObserver=new MutationObserver(function(e){wordChildMutation(e)}),loadJSON(pageOptions.transcriptURL,function(e){transcript=JSON.parse(e),pastStack.push(JSON.stringify(transcript)),fillWords(),checkDeepLink(getParams)}),setInterval(function(){saveJSON(!1)},6e4)}),[].forEach.call(document.querySelectorAll("[data-action]"),function(e){e.addEventListener("click",function(e){var t=e.currentTarget.dataset.action;t in GLOBAL_ACTIONS&&(e.preventDefault(),GLOBAL_ACTIONS[t]())})}),document.getElementById("volumerange").addEventListener("change",function(){wavesurfer.setVolume(this.value/100)});var t=document.getElementById("shortcut-wrapper"),r=document.getElementById("shift-key"),s=document.getElementById("space-key"),i=document.getElementById("extra-key");document.addEventListener("keydown",function(e){var n={32:"play",82:"rewind",72:"highlight",74:"strike",90:"undo",83:"save"};if(e.ctrlKey){t.classList.remove("hidden"),e.shiftKey&&r.classList.remove("hidden");var a=n[e.keyCode];a in GLOBAL_ACTIONS&&(e.preventDefault(),e.shiftKey&&"undo"==a?(i.innerHTML="Z",i.classList.remove("hidden"),GLOBAL_ACTIONS.redo()):(32==e.keyCode?s.classList.remove("hidden"):(i.innerHTML=e.key.toUpperCase(),i.classList.remove("hidden")),GLOBAL_ACTIONS[a]()))}}),document.addEventListener("keyup",function(e){/hidden/i.test(t.classList.toString())||t.classList.add("hidden"),/hidden/i.test(r.classList.toString())||r.classList.add("hidden"),/hidden/i.test(i.classList.toString())||i.classList.add("hidden"),/hidden/i.test(s.classList.toString())||s.classList.add("hidden")}),document.getElementById("find").addEventListener("keyup",function(){var e=this.value;[].forEach.call(document.querySelectorAll(".word"),function(t){t.innerText.search(e)>=0?/found/i.test(t.classList.toString())||t.classList.add("found"):/found/i.test(t.classList.toString())&&t.classList.remove("found")})}),document.getElementById("find-replace-form").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("find").value,r=document.getElementById("replace").value,s=0;[].forEach.call(document.querySelectorAll(".found"),function(e){e.innerText.search(t)>=0&&(e.innerText=e.innerText.replace(t,r),s++)}),document.getElementById("find-replace-wrapper").classList.add("hidden"),setTimeout(function(){[].forEach.call(document.querySelectorAll(".found"),function(e){e.classList.remove("found")})},1e3),setTimeout(function(){alert("Replaced "+s+" occurrences of '"+t+"' with '"+r+"'.")},100)}),document.getElementById("audioclip").addEventListener("mousemove",function(e){var t=document.getElementById("tooltip");t.style.top=e.clientY+"px",t.style.left=e.clientX+"px",t.innerText=toHHMMssmmm(e.layerX/wavesurfer.drawer.width*wavesurfer.getDuration()).split(",")[0],t.style.display="block"}),document.getElementById("audioclip").addEventListener("mouseleave",function(){document.getElementById("tooltip").style.display="none"});var n;document.getElementById("audioclip").addEventListener("mousedown",function(e){setTimeout(function(){var e=document.getElementsByClassName("read");n=document.createRange();try{n.setStart(e[e.length-1],0)}catch(e){}},100)}),document.getElementById("audioclip").addEventListener("mouseup",function(e){setTimeout(function(){var e=document.getElementsByClassName("read");n.setEnd(e[e.length-1],0);var t=window.getSelection();t.removeAllRanges(),t.addRange(n)},100)})}var wavesurfer=Object.create(WaveSurfer),transcript,silences,highlights,strikes,pastStack=Array(),futureStack=Array(),pageOptions,getParams,skipSilences=!1,playHighlights=!1,wordChildObserver,nodeObserver,wordObserver,GLOBAL_ACTIONS={play:function(){togglePlayPause(),wavesurfer.playPause()},stop:function(){togglePlayPause(),wavesurfer.stop(),readWords()},rewind:function(){wavesurfer.skipBackward(5)},speedx05:function(){wavesurfer.setPlaybackRate(.5),activeSpeed()},speedx1:function(){wavesurfer.setPlaybackRate(1),activeSpeed()},speedx125:function(){wavesurfer.setPlaybackRate(1.25),activeSpeed()},speedx15:function(){wavesurfer.setPlaybackRate(1.5),activeSpeed()},speedx175:function(){wavesurfer.setPlaybackRate(1.75),activeSpeed()},speedx2:function(){wavesurfer.setPlaybackRate(2),activeSpeed()},skipsilence:function(){skipSilences=!skipSilences},playhighlight:function(){playHighlights||(getHighlights(),wavesurfer.seekTo(highlights[0]/wavesurfer.getDuration())),playHighlights=!playHighlights},"toggle-hints":function(){var e=document.getElementById("hints-switch");e.classList.toggle("off"),document.getElementById("hints").classList.toggle("hidden"),/off/i.test(e.classList.toString())?(e.innerHTML="Turn Hints On",setCookie("hints","off")):(e.innerHTML="Turn Hints Off",setCookie("hints","on"))},"toggle-help":function(){var e=document.getElementById("help-switch");e.classList.toggle("off"),/off/i.test(e.classList.toString())?(e.innerHTML="Show at Startup",setCookie("help","off")):(e.innerHTML="Don't Show at Startup",setCookie("help","on"))},save:function(){saveJSON(!0)},"close-export":function(){document.getElementById("export-wrapper").classList.add("invisible"),setTimeout(function(){document.getElementById("export-wrapper").classList.add("hidden")},50)},"close-help":function(){document.getElementById("help-wrapper").classList.add("invisible"),setTimeout(function(){document.getElementById("help-wrapper").classList.add("hidden")},50)},"export-srt":function(){var e,t,r,s=transcript.results[0].results,i=transcript.results[0].speaker_labels,n=1,a=0,l=Array(),o=document.getElementById("export-highlight").checked;s.forEach(function(s,d){var u;s.alternatives.forEach(function(e,t){e.confidence>0&&(u=e,maxAlternativeIndex=t)}),r="",u.timestamps.forEach(function(s,n){e=i[a++].speaker,o?s[3]&&s[3].highlight&&(e!=t&&(r+="("+e+")"),r+="<b>"+s[0]+"</b>"):(e!=t&&(r+="("+e+") "),s[3]?s[3].strike||(s[3].highlight?r+="<b>"+s[0]+"</b>":r+=s[0]):r+=s[0]),t=e}),""!=r.trim()&&(l.push(n+++"\n"),l.push(toHHMMssmmm(u.timestamps[0][1])+" --\x3e "+toHHMMssmmm(u.timestamps[u.timestamps.length-1][2])+"\n"),l.push(r+"\n\n"))});var d=new Blob(l,{type:"text/srt"});saveAs(d,"transcript.srt"),GLOBAL_ACTIONS["close-export"]()},"export-vtt":function(){var e,t,r,s=transcript.results[0].results,i=transcript.results[0].speaker_labels,n=1,a=0,l=Array(),o=document.getElementById("export-highlight").checked;l.push("WEBVTT\n\n"),s.forEach(function(s,d){var u;s.alternatives.forEach(function(e,t){e.confidence>0&&(u=e,maxAlternativeIndex=t)}),r="",u.timestamps.forEach(function(s,n){e=i[a++].speaker,o?s[3]&&s[3].highlight&&(e!=t&&(r+="("+e+") "),r+="<b>"+s[0]+"</b>"):(e!=t&&(r+="("+e+") "),s[3]?s[3].strike||(s[3].highlight?r+="<b>"+s[0]+"</b>":r+=s[0]):r+=s[0]),t=e}),""!=r.trim()&&(l.push(n+++"\n"),l.push(toHHMMssmmm(u.timestamps[0][1]).replace(",",".")+" --\x3e "+toHHMMssmmm(u.timestamps[u.timestamps.length-1][2]).replace(",",".")+"\n"),l.push(r+"\n\n"))});var d=new Blob(l,{type:"text/vtt"});saveAs(d,"transcript.vtt"),GLOBAL_ACTIONS["close-export"]()},"export-pdf":function(){var e,t,r=transcript.results[0].results,s=transcript.results[0].speaker_labels,i=Array(),n="",a=document.getElementById("export-highlight").checked,l=document.getElementById("no-timestamps").checked;r.forEach(function(e,t){var r;e.alternatives.forEach(function(e,t){e.confidence>0&&(r=e,maxAlternativeIndex=t)}),r.timestamps.forEach(function(e,t){i.push(e)})});for(var o=0;o<i.length-1;){if(e=s[o].speaker,t=s[o+1].speaker,a){var d=e+": ";l||(d+="["+toHHMMssmmm(i[o][1]).replace(",",".")+"]")}else n+=e+": ",l||(n+="["+toHHMMssmmm(i[o][1]).replace(",",".")+"] ");do{try{t=s[o+1].speaker}catch(e){t=null}a?i[o][3]&&i[o][3].highlight&&(n+=d,d="",n+=i[o][0]):i[o][3]?i[o][3].strike||(i[o][3].highlight,n+=i[o][0]):n+=i[o][0],o++}while(e==t&&o<i.length);a&&""==d?(l||(n+="["+toHHMMssmmm(i[o-1][2]).replace(",",".")+"]"),n+="\n\n"):a||d||(l||(n+="["+toHHMMssmmm(i[o-1][2]).replace(",",".")+"]"),n+="\n\n")}var u=new jsPDF;u.setFontSize(10);for(var c=u.splitTextToSize(n,160);c.length>0;)u.text(c.splice(0,70),10,10),u.addPage();u.save("transcript.pdf"),GLOBAL_ACTIONS["close-export"]()},"export-doc":function(){var e,t,r=transcript.results[0].results,s=transcript.results[0].speaker_labels,i=Array(),n="",a=document.getElementById("export-highlight").checked,l=document.getElementById("no-timestamps").checked;r.forEach(function(e,t){var r;e.alternatives.forEach(function(e,t){e.confidence>0&&(r=e,maxAlternativeIndex=t)}),r.timestamps.forEach(function(e,t){i.push(e)})});for(var o=0;o<i.length-1;){if(e=s[o].speaker,t=s[o+1].speaker,a){var d="<w:p><w:r><w:t>"+e+": ";l||(d+="["+toHHMMssmmm(i[o][1]).replace(",",".")+"]"),d+=" </w:t></w:r>"}else n+="<w:p><w:r><w:t>"+e+": ",l||(n+="["+toHHMMssmmm(i[o][1]).replace(",",".")+"]"),n+=" </w:t></w:r>";do{try{t=s[o+1].speaker}catch(e){t=null}a?i[o][3]&&(i[o][3].strike||i[o][3].highlight&&(n+=d,d="",n+='<w:r><w:rPr><w:highlight w:val="yellow" /></w:rPr><w:t>'+i[o][0]+"</w:t></w:r>")):i[o][3]?i[o][3].strike||(i[o][3].highlight?n+='<w:r><w:rPr><w:highlight w:val="yellow" /></w:rPr><w:t>'+i[o][0]+"</w:t></w:r>":n+="<w:r><w:t>"+i[o][0]+"</w:t></w:r>"):n+="<w:r><w:t>"+i[o][0]+"</w:t></w:r>",o++}while(e==t&&o<i.length);a&&""==d?(n+="<w:r><w:t> ",l||(n+="["+toHHMMssmmm(i[o-1][2]).replace(",",".")+"]"),n+="\n\n</w:t></w:r></w:p>"):a||d||(n+="<w:r><w:t> ",l||(n+="["+toHHMMssmmm(i[o-1][2]).replace(",",".")+"]"),n+="\n\n</w:t></w:r></w:p>")}!function(e,t){JSZipUtils.getBinaryContent(e,t)}("./src/template.docx",function(e,t){if(e)throw e;var r=new JSZip(t),s=(new Docxtemplater).loadZip(r);s.setData({xml:n});try{s.render()}catch(e){var i={message:e.message,name:e.name,stack:e.stack,properties:e.properties};throw console.log(JSON.stringify({error:i})),e}var a=s.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});saveAs(a,"transcript.docx")}),GLOBAL_ACTIONS["close-export"]()},"close-find-replace":function(){document.getElementById("find-replace-wrapper").classList.add("invisible"),setTimeout(function(){document.getElementById("find-replace-wrapper").classList.add("hidden")},50),[].forEach.call(document.querySelectorAll(".found"),function(e){e.classList.remove("found")})},strike:function(){if(pastStack.push(JSON.stringify(transcript)),window.getSelection&&window.getSelection().toString().split("").length>1){var e=window.getSelection().anchorNode.parentElement;"word"!=e.classList[0]&&(e=e.nextSibling);var t=window.getSelection().focusNode.parentElement;if("word"!=t.classList[0]&&(t=t.nextSibling),Number(e.id)>Number(t.id)){var r=e;e=t,t=r}for(var s=document.getElementById(e.id);Number(s.id)<=Number(t.id);){s.classList.toggle("strike"),/highlight/i.test(s.classList.toString())&&s.classList.remove("highlight"),sWaveId="s"+s.id,hWaveId="h"+s.id,sWaveId in wavesurfer.regions.list?wavesurfer.regions.list[sWaveId].remove():(hWaveId in wavesurfer.regions.list&&wavesurfer.regions.list[hWaveId].remove(),wavesurfer.addRegion({id:sWaveId,start:s.getAttribute("starttime"),end:s.getAttribute("endtime"),color:"rgba(100, 100, 100, 0.5)",drag:!1,resize:!1}));var i=s.getAttribute("resultindex"),n=s.getAttribute("alternativeindex"),a=s.getAttribute("wordindex");if(transcript.results[0].results[i].alternatives[n].timestamps[a][3]?transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike?transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1:(transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1):(transcript.results[0].results[i].alternatives[n].timestamps[a][3]={},transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1),!s.nextSibling)break;s=s.nextSibling}}else{var l=document.getElementsByClassName("read");(s=l.length<=0?document.getElementsByClassName("word")[0]:l[l.length-1].nextSibling?l[l.length-1].nextSibling:l[l.length-1].parentNode.nextSibling.nextSibling.nextSibling?l[l.length-1].parentNode.nextSibling.nextSibling.nextSibling.firstChild:l[l.length-1]).classList.toggle("strike"),/highlight/i.test(s.classList.toString())&&s.classList.remove("highlight"),sWaveId="s"+s.id,hWaveId="h"+s.id,sWaveId in wavesurfer.regions.list?wavesurfer.regions.list[sWaveId].remove():(hWaveId in wavesurfer.regions.list&&wavesurfer.regions.list[hWaveId].remove(),wavesurfer.addRegion({id:sWaveId,start:s.getAttribute("starttime"),end:s.getAttribute("endtime"),color:"rgba(100, 100, 100, 0.5)",drag:!1,resize:!1}));var i=s.getAttribute("resultindex"),n=s.getAttribute("alternativeindex"),a=s.getAttribute("wordindex");transcript.results[0].results[i].alternatives[n].timestamps[a][3]?transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike?transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1:(transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1):(transcript.results[0].results[i].alternatives[n].timestamps[a][3]={},transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1)}getStrikes(),playHighlights&&getHighlights()},highlight:function(){if(pastStack.push(JSON.stringify(transcript)),window.getSelection&&window.getSelection().toString().split("").length>1){for(var e=window.getSelection().anchorNode.parentElement;"word"!=e.classList[0];)e=e.nextSibling;for(var t=window.getSelection().focusNode.parentElement;"word"!=t.classList[0];)t=t.nextSibling;if(Number(e.id)>Number(t.id)){var r=e;e=t,t=r}for(var s=document.getElementById(e.id);Number(s.id)<=Number(t.id);){s.classList.toggle("highlight"),/strike/i.test(s.classList.toString())&&s.classList.remove("strike"),sWaveId="s"+s.id,hWaveId="h"+s.id,hWaveId in wavesurfer.regions.list?wavesurfer.regions.list[hWaveId].remove():(sWaveId in wavesurfer.regions.list&&wavesurfer.regions.list[sWaveId].remove(),wavesurfer.addRegion({id:hWaveId,start:s.getAttribute("starttime"),end:s.getAttribute("endtime"),color:"rgba(255, 255, 0, 0.3)",drag:!1,resize:!1}));var i=s.getAttribute("resultindex"),n=s.getAttribute("alternativeindex"),a=s.getAttribute("wordindex");if(transcript.results[0].results[i].alternatives[n].timestamps[a][3]?transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight?transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1:(transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1):(transcript.results[0].results[i].alternatives[n].timestamps[a][3]={},transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1),!s.nextSibling)break;s=s.nextSibling}}else{var l=document.getElementsByClassName("read");(s=l.length<=0?document.getElementsByClassName("word")[0]:l[l.length-1].nextSibling?l[l.length-1].nextSibling:l[l.length-1].parentNode.nextSibling.nextSibling.nextSibling?l[l.length-1].parentNode.nextSibling.nextSibling.nextSibling.firstChild:l[l.length-1]).classList.toggle("highlight"),/strike/i.test(s.classList.toString())&&s.classList.remove("strike"),sWaveId="s"+s.id,hWaveId="h"+s.id,hWaveId in wavesurfer.regions.list?wavesurfer.regions.list[hWaveId].remove():(sWaveId in wavesurfer.regions.list&&wavesurfer.regions.list[sWaveId].remove(),wavesurfer.addRegion({id:hWaveId,start:s.getAttribute("starttime"),end:s.getAttribute("endtime"),color:"rgba(255, 255, 0, 0.3)",drag:!1,resize:!1}));var i=s.getAttribute("resultindex"),n=s.getAttribute("alternativeindex"),a=s.getAttribute("wordindex");transcript.results[0].results[i].alternatives[n].timestamps[a][3]?transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight?transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!1:(transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1):(transcript.results[0].results[i].alternatives[n].timestamps[a][3]={},transcript.results[0].results[i].alternatives[n].timestamps[a][3].highlight=!0,transcript.results[0].results[i].alternatives[n].timestamps[a][3].strike=!1)}getStrikes(),playHighlights&&getHighlights()},undo:function(){var e;pastStack.length>0&&(futureStack.push(JSON.stringify(transcript)),e=pastStack.pop(),transcript={},transcript=JSON.parse(e),fillWords())},redo:function(){var e;futureStack.length>0&&(pastStack.push(JSON.stringify(transcript)),e=futureStack.pop(),transcript=JSON.parse(e),fillWords())}};document.addEventListener("DOMContentLoaded",function(){"id"in(getParams=getParameters())?getURLs(getParams.id):(pageOptions={metaURL:"transcript/new-york-rock_meta.json",transcriptURL:"transcript/new-york-rock_prepared.json",audioURL:"audio/new-york-rock.mp3"},init())});