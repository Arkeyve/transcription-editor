"use strict";WaveSurfer.Drawer.MultiCanvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.MultiCanvas,{initDrawer:function(t){if(this.maxCanvasWidth=null!=t.maxCanvasWidth?t.maxCanvasWidth:4e3,this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio),this.maxCanvasWidth<=1)throw"maxCanvasWidth must be greater than 1.";if(this.maxCanvasWidth%2==1)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var t=Math.round(this.width/this.params.pixelRatio),a=Math.ceil(t/this.maxCanvasElementWidth);this.canvases.length<a;)this.addCanvas();for(;this.canvases.length>a;)this.removeCanvas();this.canvases.forEach(function(t,a){var s=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2);a==this.canvases.length-1&&(s=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(t,s,this.height),this.clearWaveForEntry(t)},this)},addCanvas:function(){var t={},a=this.maxCanvasElementWidth*this.canvases.length;t.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:a+"px",top:0,bottom:0,height:"100%"})),t.waveCtx=t.wave.getContext("2d"),this.hasProgressCanvas&&(t.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:a+"px",top:0,bottom:0,height:"100%"})),t.progressCtx=t.progress.getContext("2d")),this.canvases.push(t)},removeCanvas:function(){var t=this.canvases.pop();t.wave.parentElement.removeChild(t.wave),this.hasProgressCanvas&&t.progress.parentElement.removeChild(t.progress)},updateDimensions:function(t,a,s){var i=Math.round(a/this.params.pixelRatio),e=Math.round(this.width/this.params.pixelRatio);t.start=t.waveCtx.canvas.offsetLeft/e||0,t.end=t.start+i/e,t.waveCtx.canvas.width=a,t.waveCtx.canvas.height=s,this.style(t.waveCtx.canvas,{width:i+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(t.progressCtx.canvas.width=a,t.progressCtx.canvas.height=s,this.style(t.progressCtx.canvas,{width:i+"px"}))},clearWave:function(){this.canvases.forEach(function(t){this.clearWaveForEntry(t)},this)},clearWaveForEntry:function(t){t.waveCtx.clearRect(0,0,t.waveCtx.canvas.width,t.waveCtx.canvas.height),this.hasProgressCanvas&&t.progressCtx.clearRect(0,0,t.progressCtx.canvas.width,t.progressCtx.canvas.height)},drawBars:function(t,a,s,i){if(t[0]instanceof Array){var e=t;if(this.params.splitChannels)return this.setHeight(e.length*this.params.height*this.params.pixelRatio),void e.forEach(function(t,a){this.drawBars(t,a,s,i)},this);t=e[0]}var h=1;[].some.call(t,function(t){return t<0})&&(h=2);var r=this.width,n=this.params.height*this.params.pixelRatio,o=n*a||0,l=n/2,v=t.length/h,p=this.params.barWidth*this.params.pixelRatio,c=p+Math.max(this.params.pixelRatio,~~(p/2)),d=1/this.params.barHeight;if(this.params.normalize){var x=WaveSurfer.util.max(t),m=WaveSurfer.util.min(t);d=-m>x?-m:x}for(var f=v/r,C=s/f;C<i/f;C+=c){var u=t[Math.floor(C*f*h)]||0,g=Math.round(u/d*l);this.fillRect(C+this.halfPixel,l-g+o,p+this.halfPixel,2*g)}},drawWave:function(t,a,s,i){if(t[0]instanceof Array){var e=t;if(this.params.splitChannels)return this.setHeight(e.length*this.params.height*this.params.pixelRatio),void e.forEach(function(t,a){this.drawWave(t,a,s,i)},this);t=e[0]}if(![].some.call(t,function(t){return t<0})){for(var h=[],r=0,n=t.length;r<n;r++)h[2*r]=t[r],h[2*r+1]=-t[r];t=h}var o=this.params.height*this.params.pixelRatio,l=o*a||0,v=o/2,p=1/this.params.barHeight;if(this.params.normalize){var c=WaveSurfer.util.max(t),d=WaveSurfer.util.min(t);p=-d>c?-d:c}this.drawLine(t,p,v,l,s,i),this.fillRect(0,v+l-this.halfPixel,this.width,this.halfPixel)},drawLine:function(t,a,s,i,e,h){this.canvases.forEach(function(r){this.setFillStyles(r),this.drawLineToContext(r,r.waveCtx,t,a,s,i,e,h),this.drawLineToContext(r,r.progressCtx,t,a,s,i,e,h)},this)},drawLineToContext:function(t,a,s,i,e,h,r,n){if(a){var o=s.length/2,l=1;this.params.fillParent&&this.width!=o&&(l=this.width/o);var v=Math.round(o*t.start),p=Math.round(o*t.end);if(!(v>n||p<r)){var c=Math.max(v,r),d=Math.min(p,n);a.beginPath(),a.moveTo((c-v)*l+this.halfPixel,e+h);for(f=c;f<d;f++){var x=s[2*f]||0,m=Math.round(x/i*e);a.lineTo((f-v)*l+this.halfPixel,e-m+h)}for(var f=d-1;f>=c;f--){var x=s[2*f+1]||0,m=Math.round(x/i*e);a.lineTo((f-v)*l+this.halfPixel,e-m+h)}a.closePath(),a.fill()}}},fillRect:function(t,a,s,i){for(var e=Math.floor(t/this.maxCanvasWidth),h=Math.min(Math.ceil((t+s)/this.maxCanvasWidth)+1,this.canvases.length),r=e;r<h;r++){var n=this.canvases[r],o=r*this.maxCanvasWidth,l={x1:Math.max(t,r*this.maxCanvasWidth),y1:a,x2:Math.min(t+s,r*this.maxCanvasWidth+n.waveCtx.canvas.width),y2:a+i};l.x1<l.x2&&(this.setFillStyles(n),this.fillRectToContext(n.waveCtx,l.x1-o,l.y1,l.x2-l.x1,l.y2-l.y1),this.fillRectToContext(n.progressCtx,l.x1-o,l.y1,l.x2-l.x1,l.y2-l.y1))}},fillRectToContext:function(t,a,s,i,e){t&&t.fillRect(a,s,i,e)},setFillStyles:function(t){t.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(t.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(t){this.style(this.progressWave,{width:t+"px"})},getImage:function(t,a){var s=[];return this.canvases.forEach(function(i){s.push(i.wave.toDataURL(t,a))}),s.length>1?s:s[0]}});