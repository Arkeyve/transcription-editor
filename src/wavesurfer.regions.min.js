"use strict";WaveSurfer.Regions={init:function(e){this.wavesurfer=e,this.wrapper=this.wavesurfer.drawer.wrapper,this.list={}},add:function(e){var t=Object.create(WaveSurfer.Region);return t.init(e,this.wavesurfer),this.list[t.id]=t,t.on("remove",function(){delete this.list[t.id]}.bind(this)),t},clear:function(){Object.keys(this.list).forEach(function(e){this.list[e].remove()},this)},enableDragSelection:function(e){var t,r,i,n,s=this,a=e.slop||2,o=0,h=function(e){e.touches&&e.touches.length>1||e.target.childElementCount>0||(n=e.targetTouches?e.targetTouches[0].identifier:null,t=!0,r=s.wavesurfer.drawer.handleEvent(e,!0),i=null)};this.wrapper.addEventListener("mousedown",h),this.wrapper.addEventListener("touchstart",h),this.on("disable-drag-selection",function(){s.wrapper.removeEventListener("touchstart",h),s.wrapper.removeEventListener("mousedown",h)});var u=function(e){e.touches&&e.touches.length>1||(t=!1,o=0,i&&(i.fireEvent("update-end",e),s.wavesurfer.fireEvent("region-update-end",i,e)),i=null)};this.wrapper.addEventListener("mouseup",u),this.wrapper.addEventListener("touchend",u),this.on("disable-drag-selection",function(){s.wrapper.removeEventListener("touchend",u),s.wrapper.removeEventListener("mouseup",u)});var d=function(h){if(t&&!(++o<=a||h.touches&&h.touches.length>1||h.targetTouches&&h.targetTouches[0].identifier!=n)){i||(i=s.add(e||{}));var u=s.wavesurfer.getDuration(),d=s.wavesurfer.drawer.handleEvent(h);i.update({start:Math.min(d*u,r*u),end:Math.max(d*u,r*u)})}};this.wrapper.addEventListener("mousemove",d),this.wrapper.addEventListener("touchmove",d),this.on("disable-drag-selection",function(){s.wrapper.removeEventListener("touchmove",d),s.wrapper.removeEventListener("mousemove",d)})},disableDragSelection:function(){this.fireEvent("disable-drag-selection")}},WaveSurfer.util.extend(WaveSurfer.Regions,WaveSurfer.Observer),WaveSurfer.Region={style:WaveSurfer.Drawer.style,init:function(e,t){this.wavesurfer=t,this.wrapper=t.drawer.wrapper,this.id=null==e.id?WaveSurfer.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize||Boolean(e.resize),this.drag=void 0===e.drag||Boolean(e.drag),this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.data=e.data||{},this.attributes=e.attributes||{},this.maxLength=e.maxLength,this.minLength=e.minLength,this.bindInOut(),this.render(),this.onZoom=this.updateRender.bind(this),this.wavesurfer.on("zoom",this.onZoom),this.wavesurfer.fireEvent("region-created",this)},update:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)},remove:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.wavesurfer.un("zoom",this.onZoom),this.fireEvent("remove"),this.wavesurfer.fireEvent("region-removed",this))},play:function(){this.wavesurfer.play(this.start,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)},playLoop:function(){this.play(),this.once("out",this.playLoop.bind(this))},render:function(){var e=document.createElement("region");e.className="wavesurfer-region",e.title=this.formatTime(this.start,this.end),e.setAttribute("data-id",this.id);for(var t in this.attributes)e.setAttribute("data-region-"+t,this.attributes[t]);this.wrapper.scrollWidth;if(this.style(e,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var r=e.appendChild(document.createElement("handle")),i=e.appendChild(document.createElement("handle"));r.className="wavesurfer-handle wavesurfer-handle-start",i.className="wavesurfer-handle wavesurfer-handle-end";var n={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(r,n),this.style(i,n),this.style(i,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)},formatTime:function(e,t){return(e==t?[e]:[e,t]).map(function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")}).join("-")},getWidth:function(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio},updateRender:function(){var e=this.wavesurfer.getDuration(),t=this.getWidth();if(this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>e&&(this.end=e,this.start=e-(this.end-this.start)),null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end)),null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end)),null!=this.element){var r=Math.round(this.start/e*t),i=Math.round(this.end/e*t)-r;this.style(this.element,{left:r+"px",width:i+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(var n in this.attributes)this.element.setAttribute("data-region-"+n,this.attributes[n]);this.element.title=this.formatTime(this.start,this.end)}},bindInOut:function(){var e=this;e.firedIn=!1,e.firedOut=!1;var t=function(t){!e.firedOut&&e.firedIn&&(e.start>=Math.round(100*t)/100||e.end<=Math.round(100*t)/100)&&(e.firedOut=!0,e.firedIn=!1,e.fireEvent("out"),e.wavesurfer.fireEvent("region-out",e)),!e.firedIn&&e.start<=t&&e.end>t&&(e.firedIn=!0,e.firedOut=!1,e.fireEvent("in"),e.wavesurfer.fireEvent("region-in",e))};this.wavesurfer.backend.on("audioprocess",t),this.on("remove",function(){e.wavesurfer.backend.un("audioprocess",t)}),this.on("out",function(){e.loop&&e.wavesurfer.play(e.start)})},bindEvents:function(){var e=this;this.element.addEventListener("mouseenter",function(t){e.fireEvent("mouseenter",t),e.wavesurfer.fireEvent("region-mouseenter",e,t)}),this.element.addEventListener("mouseleave",function(t){e.fireEvent("mouseleave",t),e.wavesurfer.fireEvent("region-mouseleave",e,t)}),this.element.addEventListener("click",function(t){t.preventDefault(),e.fireEvent("click",t),e.wavesurfer.fireEvent("region-click",e,t)}),this.element.addEventListener("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent("dblclick",t),e.wavesurfer.fireEvent("region-dblclick",e,t)}),(this.drag||this.resize)&&function(){var t,r,i,n,s=e.wavesurfer.getDuration(),a=function(a){a.touches&&a.touches.length>1||(n=a.targetTouches?a.targetTouches[0].identifier:null,a.stopPropagation(),i=e.wavesurfer.drawer.handleEvent(a,!0)*s,"handle"==a.target.tagName.toLowerCase()?r=a.target.classList.contains("wavesurfer-handle-start")?"start":"end":(t=!0,r=!1))},o=function(i){i.touches&&i.touches.length>1||(t||r)&&(t=!1,r=!1,e.fireEvent("update-end",i),e.wavesurfer.fireEvent("region-update-end",e,i))},h=function(a){if(!(a.touches&&a.touches.length>1)&&(!a.targetTouches||a.targetTouches[0].identifier==n)&&(t||r)){var o=e.wavesurfer.drawer.handleEvent(a)*s,h=o-i;i=o,e.drag&&t&&e.onDrag(h),e.resize&&r&&e.onResize(h,r)}};e.element.addEventListener("mousedown",a),e.element.addEventListener("touchstart",a),e.wrapper.addEventListener("mousemove",h),e.wrapper.addEventListener("touchmove",h),document.body.addEventListener("mouseup",o),document.body.addEventListener("touchend",o),e.on("remove",function(){document.body.removeEventListener("mouseup",o),document.body.removeEventListener("touchend",o),e.wrapper.removeEventListener("mousemove",h),e.wrapper.removeEventListener("touchmove",h)}),e.wavesurfer.on("destroy",function(){document.body.removeEventListener("mouseup",o),document.body.removeEventListener("touchend",o)})}()},onDrag:function(e){var t=this.wavesurfer.getDuration();this.end+e>t||this.start+e<0||this.update({start:this.start+e,end:this.end+e})},onResize:function(e,t){"start"==t?this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}):this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}},WaveSurfer.util.extend(WaveSurfer.Region,WaveSurfer.Observer),WaveSurfer.initRegions=function(){this.regions||(this.regions=Object.create(WaveSurfer.Regions),this.regions.init(this))},WaveSurfer.addRegion=function(e){return this.initRegions(),this.regions.add(e)},WaveSurfer.clearRegions=function(){this.regions&&this.regions.clear()},WaveSurfer.enableDragSelection=function(e){this.initRegions(),this.regions.enableDragSelection(e)},WaveSurfer.disableDragSelection=function(){this.regions.disableDragSelection()};